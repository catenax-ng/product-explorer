<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Product Explorer</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link th:rel="stylesheet" th:href="@{/webjars/bootstrap/5.1.3/css/bootstrap.min.css} "/>
</head>

<body>
<div id="search-bar-container" class="container h-100 mt-3">
    <div class="d-flex justify-content-center align-items-center gap-2">
        <div class="searchbar">
            <input class="search_input" type="text" id="name-input" placeholder="Search...">
            <a href="#" class="search_icon"><i class="fas fa-search"></i></a>
        </div>
        <button id="search-btn" type="button" class="btn btn-primary btn-sm">Search</button>
    </div>
</div>
<div id="loading-indicator" class="container h-100 mt-3" style="display: none">
    <div class="d-flex justify-content-center align-items-center gap-2">
        <div class="spinner-border spinner-border-sm" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <div class="spinner-grow spinner-grow-sm" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <div class="spinner-border spinner-border-sm" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
</div>

<script th:src="@{/webjars/jquery/3.6.0/jquery.min.js}"></script>
<script th:src="@{/webjars/popper.js/2.9.3/umd/popper.min.js}"></script>
<script th:src="@{/webjars/bootstrap/5.1.3/js/bootstrap.min.js}"></script>

<script>
    var explorerApplicationUrl = "[[${explorerApplicationUrl}]]";

    $(document).ready(function () {
        $("#search-btn").click(function () {
            let query = $('#name-input').val();
            if (canSendQuery(query)) {
                makeSearch(query);
            }
        });
        $("#name-input").keypress(function (event) {
            var keycode = (event.keyCode ? event.keyCode : event.which);
            if (keycode == '13') {
                let query = $('#name-input').val();
                if (query !== undefined && query.length > 0) {
                    makeSearch(query);
                }
            }
        });
    });

    function canSendQuery(query) {
        return query !== undefined && $.trim(query).length > 0;
    }

    function getAssetSearchUrl(query) {
        return explorerApplicationUrl + "/v1/asset/" + query;
    }

    function makeSearch(query) {
        $('#search-bar-container').hide();
        $('#loading-indicator').show();
        $.get(getAssetSearchUrl(query), function (data) {
            alert(JSON.stringify(data));
        }).fail(function (res) {

        }).always(function () {
            $('#loading-indicator').hide();
            $('#search-bar-container').show();
        });
    }
</script>
</body>
</html>
